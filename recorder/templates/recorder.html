<<<<<<< HEAD
<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

<title>Recorder</title>

</head>
<body>
<!--Load the core library, other types of support libraries in the following according to the user click select load-->
<!-- <script src="src/recorder-core.js"></script> -->

<input type="file" accept="audio/*" capture="microphone" id="recorder">
<audio id="player" controls></audio>
<!-- <script>
    var recorder = document.getElementById('recorder');
    var player = document.getElementById('player');

    recorder.addEventListener('change', function(e) {
        var file = e.target.files[0];
        // Do something with the audio file.
        player.src =  URL.createObjectURL(file);
    });
</script> -->

<!-- get microphone access -->
<!-- <script>
    var player = document.getElementById('player');

    var handleSuccess = function(stream) {
        if (window.URL) {
            player.src = window.URL.createObjectURL(stream);
        } else {
            player.src = stream;
        }
    };

    navigator.mediaDevices.getUserMedia({ audio: true, video: false })
        .then(handleSuccess)
</script> -->

<!-- get original data through microphone -->
<script>
    var handleSuccess = function(stream) {
        var context = new AudioContext();
        var input = context.createMediaStreamSource(stream)
        var processor = context.createScriptProcessor(1024,1,1);
  
        source.connect(processor);
        processor.connect(context.destination);
  
        processor.onaudioprocess = function(e){
        // Do something with the data, i.e Convert this to WAV
        console.log(e.inputBuffer);
        };
    };
  
    navigator.mediaDevices.getUserMedia({ audio: true, video: false })
        .then(handleSuccess)
</script>


<a id="download">Download
    <button id="stop">Stop
    <script>
      let shouldStop = false;
      let stopped = false;
      const downloadLink = document.getElementById('download');
      const stopButton = document.getElementById('stop');
    
      stopButton.addEventListener('click', function() {
        shouldStop = true;
      })
    
      var handleSuccess = function(stream) {
        const options = {mimeType: 'video/webm;codecs=vp9'};
        const recordedChunks = [];
        const mediaRecorder = new MediaRecorder(stream, options);
    
        mediaRecorder.addEventListener('dataavailable', function(e) {
          if (e.data.size > 0) {
            recordedChunks.push(e.data);
          }
    
          if(shouldStop === true && stopped === false) {
            mediaRecorder.stop();
            stopped = true;
          }
        });
    
        mediaRecorder.addEventListener('stop', function() {
          downloadLink.href = URL.createObjectURL(new Blob(recordedChunks));
          downloadLink.download = 'acetest.wav';
        });
    
        mediaRecorder.start();
      };
    
      navigator.mediaDevices.getUserMedia({ audio: true, video: false })
          .then(handleSuccess);
    </script>    

</body>
=======
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CITS5206 Recording test demo</title>
</head>
<body>
<script src="https://xiangyuecn.github.io/Recorder/recorder.mp3.min.js"></script>
<input type="button" onclick="startRec()" value="start recording">
<hr>
<input type="button" onclick="playRec()" value="stop it and play it!">
<input type="button" onclick="uploadRec()" value="stop it and upload it to server!">

<script>
    var rec;

    function startRec() {
        rec = Recorder();//Use the default configuration, mp3 format

        //Turn on the microphone and authorize resources
        rec.open(function () {
            //start recording
            rec.start();
        }, function (msg, isUserNotAllow) {
            //The user has refused permission or the browser does not support it
            alert((isUserNotAllow ? "User denied permission，" : "") + "not able to record:" + msg);
        });
    };
</script>
<script>
    function uploadRec() {
        //Stop recording and get the blob binary object of the recording file
        rec.stop(function (blob, duration) {
            /*
            Blob file object, which can be read and fetched with FileReader
            ，Or use FormData upload, which in this case uploads the binary directly
            ，from normal application/x-www-form-urlencoded form upload
            */
            var form = new FormData();
            form.append("upfile", blob, "recorder.mp3"); //Similar to ordinary form forms, files with upfile parameters, named recorder. Mp3, are received by the back-end

            //Upload directly with ajax
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/recorder");//This fake address can see the request data and format in the console network, and the result of the request is irrelevant
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    alert(xhr.status == 200 ? "upload successful" : "Test by opening the browser console, and then re-recording, you can see the upload request data and format in the network option card");
                }
            }
            xhr.send(form);
        }, function (msg) {
            alert("fail to record:" + msg);
        });
    };</script>
<script>
    function playRec() {
        //Stop recording and get the blob binary object of the recording file
        rec.stop(function (blob, duration) {
            var audio = document.createElement("audio");
            audio.controls = true;
            document.body.appendChild(audio);

            //get the blob audio url
            audio.src = URL.createObjectURL(blob);
            audio.play();
        }, function (msg) {
            alert("fail to record:" + msg);
        });
    };</script>


</body>
</html>
>>>>>>> master
