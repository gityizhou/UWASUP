{% extends "base.html" %}

{% block content %}
    <!-- 
        As per the client's request, we have minimised movement to other pages by using nested modals within the teacher view.
        This has made the teacher view a complex nested structure, so for clarity we have summarised the structure below:
        ..................
        Teacher details and actions:
            Details
            Make a User a Teacher
            Delete a User
            Add a Unit
        Unit:
            Edit Unit
            Delete Unit
            Add Task
            Task:
                Edit Task
                Delete Task
                Add Question
                Questions:
                    Question
                        Edit Question
                        Delete Question
                        Description
                Student Submissions:
                    Download All Recorded Answers
                    Donwload List of Submitters
                    Student:
                        Task Mark & Comment
                        Teacher Feedback Recording Module
                        Question:
                            Recorded Answers Playback Module
        Error Modals:
            Edit Unit
            Add Task
            Edit Task
            Edit Question
        ...................
     -->
    <!-- start of card -->
    <div class="col-xl-7 col-lg-10 col-md-10 col-sm-12 col-12 mx-auto main-card">
        <div class="card-deck">
            <div class="card-body text-center">
                <!-- teacher details and actions -->
                <div>
                    <h3 class="greeting">Hello, {{ teacher.first_name }}!</h3>
                </div>
                <div class="user-action-buttons">
                    <button class="btn btn-primary btn-form-submit">
                        <a href="{{ url_for('logout') }}">Logout</a>
                    </button>


                    <!-- MAKE A USER A TEACHER modal -->
                    <!-- button to open the modal -->
                    <button id="btn-make-teacher" type="button" class="btn btn-primary btn-form-submit second-user-button" data-toggle="modal" data-target="#modal-make-teacher">
                        Make a User a Teacher
                    </button>
                    <!-- keeps modal open if validation fails so user can see errors -->
                    {% if form_make_teacher.staffNumber.errors|length != 0 %}
                        <script>
                            $(document).ready(function(){
                                $("#modal-make-teacher").modal("show");
                            });
                        </script>
                    {% endif %}
                    <!-- code for modal window -->
                    <div class="modal" id="modal-make-teacher">
                        <div class="modal-dialog sup-modal-dialog">
                            <div class="modal-content sup-modal">
                                <!-- modal header -->
                                <div class="modal-header">
                                <h4 class="modal-title">Make a User a Teacher</h4>
                                    <button  id="btn-top-close-make-teacher-modal" type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>
                                <!-- modal body -->
                                <div class="modal-body show">
                                    <form id="form-make-teacher" class="form" action="" method="post" novalidate>
                                        {{ form_make_teacher.hidden_tag() }}
                                        <p>
                                            {{ form_make_teacher.staffNumber.label }}<br>
                                            {{ form_make_teacher.staffNumber(size=32, class="form-field") }}<br>
                                            {% for error in form_make_teacher.staffNumber.errors %}
                                                <span style="color: red;">{{ error }}</span>
                                            {% endfor %}
                                        </p>
                                        <a>{{ form_make_teacher.make_teacher_submit(id="btn-make-teacher-submit", class="btn btn-primary btn-form-submit") }}</a>
                                    </form>
                                </div>
                                <!-- modal footer -->
                                <div class="modal-footer">
                                    <button id="btn-btm-close-make-teacher-modal" type="button" class="btn btn-form-secondary" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end MAKE A USER A TEACHER modal -->


                    <!-- DELETE A USER modal -->
                    <!-- button to open the modal -->
                    <button id="btn-delete-user" type="button" class="btn btn-primary btn-form-submit second-user-button" data-toggle="modal" data-target="#modal-delete-user">
                        Delete a Student or Teacher
                    </button>
                    <!-- keeps modal open if validation fails so user can see errors -->
                    {% if form_delete_user.userNumber.errors|length != 0 %}
                        <script>
                            $(document).ready(function(){
                                $("#modal-delete-user").modal("show");
                            });
                        </script>
                    {% endif %}
                    <!-- code for modal window -->
                    <div class="modal" id="modal-delete-user">
                        <div class="modal-dialog sup-modal-dialog">
                            <div class="modal-content sup-modal">
                                <!-- modal header -->
                                <div class="modal-header">
                                <h4 class="modal-title">Delete a User</h4>
                                    <button  id="btn-top-close-delete-user-modal" type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>
                                <!-- modal body -->
                                <div class="modal-body show">
                                    <form id="form-delete-user" class="form" action="" method="post" novalidate>
                                        {{ form_delete_user.hidden_tag() }}
                                        <p>
                                            {{ form_delete_user.userNumber.label }}<br>
                                            {{ form_delete_user.userNumber(size=32, class="form-field") }}<br>
                                            {% for error in form_delete_user.userNumber.errors %}
                                                <span style="color: red;">{{ error }}</span>
                                            {% endfor %}
                                        </p>
                                        <a>{{ form_delete_user.delete_user_submit(id="btn-delete-user-submit", class="btn btn-primary btn-form-submit") }}</a>
                                    </form>
                                </div>
                                <!-- modal footer -->
                                <div class="modal-footer">
                                    <button id="btn-btm-close-delete-user-modal" type="button" class="btn btn-form-secondary" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end DELETE A USER modal -->


                    <!-- CREATE A UNIT modal -->
                    <!-- button to open the modal -->
                    <button id="btn-create-unit" type="button" class="btn btn-primary btn-form-submit second-user-button" data-toggle="modal" data-target="#modal-create-unit">
                        Create a Unit
                    </button>
                    <!-- keeps modal open if validation fails so user can see errors -->
                    {% if form_create_unit.unitID.errors|length != 0 or form_create_unit.unitName.errors|length != 0 %}
                        <script>
                            $(document).ready(function(){
                                $("#modal-create-unit").modal("show");
                            });
                        </script>
                    {% endif %}
                    <!-- code for modal window -->
                    <div class="modal" id="modal-create-unit">
                        <div class="modal-dialog sup-modal-dialog">
                            <div class="modal-content sup-modal">
                                <!-- modal header -->
                                <div class="modal-header">
                                <h4 class="modal-title">Create a Unit</h4>
                                    <button  id="btn-top-close-create-unit-modal" type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>
                                <!-- modal body -->
                                <div class="modal-body show">
                                    <form id="form-create-unit" class="form" action="" method="post" novalidate>
                                        {{ form_create_unit.hidden_tag() }}
                                        <p>
                                            {{ form_create_unit.unitID.label }}<br>
                                            {{ form_create_unit.unitID(size=32, class="form-field") }}<br>
                                            {% for error in form_create_unit.unitID.errors %}
                                                <span style="color: red;">{{ error }}</span>
                                            {% endfor %}
                                        </p>
                                        <p>
                                            {{ form_create_unit.unitName.label }}<br>
                                            {{ form_create_unit.unitName(size=32, class="form-field") }}<br>
                                            {% for error in form_create_unit.unitName.errors %}
                                                <span style="color: red;">{{ error }}</span>
                                            {% endfor %}
                                        </p>
                                        <a>{{ form_create_unit.create_unit_submit(id="btn-create-unit-submit", class="btn btn-primary btn-form-submit") }}</a>
                                    </form>
                                </div>
                                <!-- modal footer -->
                                <div class="modal-footer">
                                    <button id="btn-btm-close-create-unit-modal" type="button" class="btn btn-form-secondary" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end CREATE A UNIT modal -->
                    
                </div>
                <!-- end teacher details and actions -->
                <hr>

                <!-- list of units, tasks, students and questions as nested Bootstrap4 accordions -->

                <!-- list of all units -->
                <div id="accordion_units">
                {% for unit in all_units %}
                    <div class="card">
                        <div class="card-header" id="heading_unit_{{ unit.id }}">
                            <h5 class="mb-0">
                                <button class="btn btn-link" data-toggle="collapse" data-target="#collapse_unit_{{ unit.id }}" aria-expanded="true" aria-controls="collapse_unit_{{ unit.id }}">
                                    {{ unit.unit_id }} {{ unit.unit_name }}
                                </button>
                            </h5>
                        </div>
                        <div id="collapse_unit_{{ unit.id }}" class="collapse" aria-labelledby="heading_unit_{{ unit.id }}" data-parent="#accordion_units">
                            <div class="card-body sup-accordian-first-level">

                                <!-- EDIT UNIT modal -->
                                <!-- button to open the modal -->
                                <button id="btn-edit-unit-{{ unit.id }}" type="button" class="btn btn-primary inner-accordian-button" data-toggle="modal" data-target="#modal-edit-unit-{{ unit.id }}">
                                    Edit Unit
                                </button>
                                <!-- code for modal window -->
                                <div class="modal" id="modal-edit-unit-{{ unit.id }}">
                                    <div class="modal-dialog sup-modal-dialog">
                                        <div class="modal-content sup-modal">
                                            <!-- modal header -->
                                            <div class="modal-header">
                                            <h4 class="modal-title">Edit Unit</h4>
                                                <button  id="btn-top-close-edit-unit-{{ unit.id }}-modal" type="button" class="close" data-dismiss="modal">&times;</button>
                                            </div>
                                            <!-- modal body -->
                                            <div class="modal-body show">
                                                <form id="form-edit-unit-{{ unit.id }}" class="form" action="" method="post" novalidate>
                                                    {{ form_edit_unit.hidden_tag() }}
                                                    <p>
                                                        {{ form_edit_unit.edit_unitID.label }}<br>
                                                        {{ form_edit_unit.edit_unitID(value=unit.unit_id, size=32, class="form-field") }}<br>
                                                        {{ form_edit_unit.edit_unitName.label }}<br>
                                                        {{ form_edit_unit.edit_unitName(value=unit.unit_name, size=32, class="form-field") }}<br>
                                                        {{ form_edit_unit.current_unitID(value=unit.unit_id, style="display: none;") }}
                                                    </p>
                                                    <a>{{ form_edit_unit.edit_unit_submit(id="btn-edit-unit-{{ unit.id }}-submit", class="btn btn-primary btn-form-submit") }}</a>
                                                </form>
                                            </div>
                                            <!-- modal footer -->
                                            <div class="modal-footer">
                                                <button id="btn-btm-close-edit-unit-{{ unit.id }}-modal" type="button" class="btn btn-form-secondary" data-dismiss="modal">Close</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- end EDIT UNIT modal -->


                                <!-- DELETE UNIT modal -->
                                <!-- button to open the modal -->
                                <button id="btn-delete-unit-{{ unit.id }}" type="button" class="btn btn-primary inner-accordian-button" data-toggle="modal" data-target="#modal-delete-unit-{{ unit.id }}">
                                        Delete Unit
                                    </button>
                                    <!-- code for modal window -->
                                    <div class="modal" id="modal-delete-unit-{{ unit.id }}">
                                        <div class="modal-dialog sup-modal-dialog">
                                            <div class="modal-content sup-modal">
                                                <!-- modal header -->
                                                <div class="modal-header">
                                                    <button  id="btn-top-close-delete-unit-{{ unit.id }}" type="button" class="close" data-dismiss="modal">&times;</button>
                                                </div>
                                                <!-- modal body -->
                                                <div class="modal-body">
                                                    <h5>Are you sure?</h5>
                                                    <p>Deleting a unit will permanently delete all tasks, questions and student submissions associated with this unit.</p>
                                                    <form class="form" action="" method="post" novalidate>
                                                        {{ form_delete_unit.hidden_tag() }}
                                                        {{ form_delete_unit.del_unitID(value=unit.id, style="display: none;") }}
                                                        <a>{{ form_delete_unit.delete_unit_submit(class="btn btn-primary btn-form-submit") }}</a>
                                                    </form>
                                                </div>
                                                <!-- modal footer -->
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-form-secondary" data-dismiss="modal">Cancel</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- end DELETE UNIT modal -->


                                    <!-- ADD TASK modal -->
                                    <!-- button to open the modal -->
                                    <button id="btn-add-task-{{ unit.id }}" type="button" class="btn btn-primary inner-accordian-button" data-toggle="modal" data-target="#modal-add-task-{{ unit.id }}">
                                        Add Task
                                    </button>
                                    <!-- code for modal window -->
                                    <div class="modal" id="modal-add-task-{{ unit.id }}">
                                        <div class="modal-dialog sup-modal-dialog">
                                            <div class="modal-content sup-modal">
                                                <!-- modal header -->
                                                <div class="modal-header">
                                                <h4 class="modal-title">Add Task to Unit</h4>
                                                    <button  id="btn-top-close-add-task-{{ unit.id }}-modal" type="button" class="close" data-dismiss="modal">&times;</button>
                                                </div>
                                                <!-- modal body -->
                                                <div class="modal-body show">
                                                    <form id="form-add-task-{{ unit.id }}" class="form" action="" method="post" novalidate>
                                                        {{ form_add_task.hidden_tag() }}
                                                        <p>
                                                            {{ form_add_task.taskName.label }}<br>
                                                            {{ form_add_task.taskName(size=32, class="form-field") }}<br>
                                                            {{ form_add_task.taskDescription.label }}<br>
                                                            {{ form_add_task.taskDescription(size=32, class="form-field") }}<br>
                                                            {{ form_add_task.taskDueDate.label }}<br>
                                                            {{ form_add_task.taskDueDate(size=32, class="form-field") }}<br>
                                                            {{ form_add_task.taskDueTime.label }}<br>
                                                            {{ form_add_task.taskDueTime(size=32, class="form-field") }}<br>
                                                            {{ form_add_task.task_unitID(value=unit.id, style="display: none;") }}
                                                        </p>
                                                        <a>{{ form_add_task.add_task_submit(id="btn-add-task-{{ unit.id }}-submit", size=32, class="form-field btn btn-primary btn-form-submit") }}</a>
                                                    </form>
                                                </div>
                                                <!-- modal footer -->
                                                <div class="modal-footer">
                                                    <button id="btn-btm-close-add-task-{{ unit.id }}-modal" type="button" class="btn btn-form-secondary" data-dismiss="modal">Close</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- end ADD TASK modal -->    


                                    <!-- list of tasks for each unit -->
                                    <div id="accordion_tasks">
                                        {% for task in unit.tasks %}
                                            <div class="card">
                                                <div class="card-header" id="heading_task_{{ task.id }}">
                                                    <h5 class="mb-0">
                                                        <button class="btn btn-link" data-toggle="collapse" data-target="#collapse_task_{{ task.id }}" aria-expanded="true" aria-controls="collapse_task_{{ task.id }}">
                                                            Task: {{ task.task_name }}
                                                        </button>
                                                    </h5>
                                                </div>
                                                <div id="collapse_task_{{ task.id }}" class="collapse" aria-labelledby="heading_task_{{ task.id }}" data-parent="#accordion_tasks">
                                                    <div class="card-body sup-accordian-second-level">
                                                        <!-- display due date and time if any -->
                                                        {% if task.due_time is not none %}
                                                            {% set due_datetime_string = task.due_time|string() %}
                                                            <p class="details">Due date: {{ due_datetime_string[:10] }}</p>
                                                            <p class="details">Due time: {{ due_datetime_string[11:16] }}</p>
                                                        {% else %}
                                                            <p class="details">Due date: not set</p>
                                                            <p class="details">Due time: not set</p>
                                                        {% endif %}
                                                        {% if task.description is not none %}
                                                            <p class="details last-detail">Description: {{ task.description }}</p>
                                                        {% else %}
                                                            <p class="details last-detail">Description: no description</p>
                                                        {% endif %}
                                                        <!-- display due date and time if any -->

                                                        <!-- EDIT TASK modal -->
                                                        <!-- button to open the modal -->
                                                        <button id="btn-edit-task-{{ task.id }}" type="button" class="btn btn-primary inner-accordian-button" data-toggle="modal" data-target="#modal-edit-task-{{ task.id }}">
                                                            Edit Task
                                                        </button>
                                                        <!-- code for modal window -->
                                                        <div class="modal" id="modal-edit-task-{{ task.id }}">
                                                            <div class="modal-dialog sup-modal-dialog">
                                                                <div class="modal-content sup-modal">
                                                                    <!-- modal header -->
                                                                    <div class="modal-header">
                                                                    <h4 class="modal-title">Edit Task</h4>
                                                                        <button  id="btn-top-close-edit-task-{{ task.id }}-modal" type="button" class="close" data-dismiss="modal">&times;</button>
                                                                    </div>
                                                                    <!-- modal body -->
                                                                    <div class="modal-body show">
                                                                        <form id="form-edit-task-{{ task.id }}" class="form" action="" method="post" novalidate>
                                                                            {{ form_edit_task.hidden_tag() }}
                                                                            <p>
                                                                                {{ form_edit_task.edit_taskName.label }}<br>
                                                                                {{ form_edit_task.edit_taskName(value=task.task_name, size=32, class="form-field") }}<br>
                                                                                {{ form_edit_task.edit_taskDescription.label }}<br>
                                                                                {{ form_edit_task.edit_taskDescription(value=task.description, size=32, class="form-field") }}<br>
                                                                                {% if task.due_time is not none %}
                                                                                    {% set due_time_string = task.due_time|string() %}
                                                                                    {{ form_edit_task.edit_taskDueDate.label }}<br>
                                                                                    {{ form_edit_task.edit_taskDueDate(value=due_time_string[:10], size=32, class="form-field") }}<br>
                                                                                    {{ form_edit_task.edit_taskDueTime.label }}<br>
                                                                                    {{ form_edit_task.edit_taskDueTime(value=due_time_string[11:16], size=32, class="form-field") }}<br>
                                                                                {% else %}
                                                                                    {{ form_edit_task.edit_taskDueDate.label }}<br>
                                                                                    {{ form_edit_task.edit_taskDueDate(size=32, class="form-field") }}<br>
                                                                                    {{ form_edit_task.edit_taskDueTime.label }}<br>
                                                                                    {{ form_edit_task.edit_taskDueTime(size=32, class="form-field") }}<br>
                                                                                {% endif %}
                                                                                {{ form_edit_task.current_taskID(value=task.id, style="display: none;") }}
                                                                            </p>
                                                                            <a>{{ form_edit_task.edit_task_submit(id="btn-edit-task-{{ task.id }}-submit", size=32, class="form-field btn btn-primary btn-form-submit") }}</a>
                                                                        </form>
                                                                    </div>
                                                                    <!-- modal footer -->
                                                                    <div class="modal-footer">
                                                                        <button id="btn-btm-close-edit-task-{{ task.id }}-modal" type="button" class="btn btn-form-secondary" data-dismiss="modal">Close</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- end EDIT TASK modal -->    
                                                        
                                                        <!-- DELETE TASK modal -->
                                                        <!-- button to open the modal -->
                                                        <button id="btn-delete-task-{{ task.id }}" type="button" class="btn btn-primary inner-accordian-button" data-toggle="modal" data-target="#modal-delete-task-{{ task.id }}">
                                                            Delete Task
                                                        </button>
                                                        <!-- code for modal window -->
                                                        <div class="modal" id="modal-delete-task-{{ task.id }}">
                                                            <div class="modal-dialog sup-modal-dialog">
                                                                <div class="modal-content sup-modal">
                                                                    <!-- modal header -->
                                                                    <div class="modal-header">
                                                                    <button id="btn-top-close-delete-task-{{ task.id }}" type="button" class="close" data-dismiss="modal">&times;</button>
                                                                    </div>
                                                                    <!-- modal body -->
                                                                    <div class="modal-body">
                                                                        <h5>Are you sure?</h5>
                                                                        <p>Deleting a task will permanently delete all questions and student submissions associated with this task.</p>
                                                                        <form class="form" action="" method="post" novalidate>
                                                                            {{ form_delete_task.hidden_tag() }}
                                                                            {{ form_delete_task.del_taskID(value=task.id, style="display: none;") }}
                                                                            <a>{{ form_delete_task.delete_task_submit(class="btn btn-primary btn-form-submit") }}</a>
                                                                        </form>
                                                                    </div>
                                                                    <!-- modal footer -->
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-form-secondary" data-dismiss="modal">Cancel</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- end DELETE TASK modal -->

                                                        <!-- ADD QUESTION modal -->
                                                        <!-- button to open the modal -->
                                                        <button id="btn-add-question-{{ task.id }}" type="button" class="btn btn-primary inner-accordian-button" data-toggle="modal" data-target="#modal-add-question-{{ task.id }}">
                                                            Add Question
                                                        </button>
                                                        <!-- code for modal window -->
                                                        <div class="modal" id="modal-add-question-{{ task.id }}">
                                                            <div class="modal-dialog sup-modal-dialog">
                                                                <div class="modal-content sup-modal">
                                                                    <!-- modal header -->
                                                                    <div class="modal-header">
                                                                    <h4 class="modal-title">Add Question to Task</h4>
                                                                        <button  id="btn-top-close-add-question-{{ task.id }}-modal" type="button" class="close" data-dismiss="modal">&times;</button>
                                                                    </div>
                                                                    <!-- modal body -->
                                                                    <div class="modal-body show">
                                                                        <form id="form-add-question-{{ task.id }}" class="form" action="" method="post" novalidate>
                                                                            {{ form_add_question.hidden_tag() }}
                                                                            <p>
                                                                                {{ form_add_question.questionName.label }}<br>
                                                                                {{ form_add_question.questionName(size=32, class="form-field") }}<br>
                                                                                {{ form_add_question.questionDescription.label }}<br>
                                                                                {{ form_add_question.questionDescription(size=32, class="form-field") }}<br>
                                                                                {{ form_add_question.question_taskID(value=task.id, style="display: none;") }}
                                                                            </p>
                                                                            <a>{{ form_add_question.add_question_submit(id="btn-add-question-{{ task.id }}-submit", size=32, class="form-field btn btn-primary btn-form-submit") }}</a>
                                                                        </form>
                                                                    </div>
                                                                    <!-- modal footer -->
                                                                    <div class="modal-footer">
                                                                        <button id="btn-btm-close-add-question-{{ task.id }}-modal" type="button" class="btn btn-form-secondary" data-dismiss="modal">Close</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- end ADD QUESTION modal -->
                                                        
                                                        <!-- UPLOAD PDF modal -->
                                                        <!-- button to open the modal -->
                                                        <button id="btn-upload-pdf-{{ task.id }}" type="button" class="btn btn-primary inner-accordian-button" data-toggle="modal" data-target="#modal-upload-pdf-{{ task.id }}">
                                                            Upload PDF
                                                        </button>
                                                        <!-- code for modal window -->
                                                        <div class="modal" id="modal-upload-pdf-{{ task.id }}">
                                                            <div class="modal-dialog sup-modal-dialog">
                                                                <div class="modal-content sup-modal">
                                                                    <!-- modal header -->
                                                                    <div class="modal-header">
                                                                    <h4 class="modal-title">Upload PDF</h4>
                                                                        <button  id="btn-top-close-upload-pdf-{{ task.id }}-modal" type="button" class="close" data-dismiss="modal">&times;</button>
                                                                    </div>
                                                                    <!-- modal body -->
                                                                    <div class="modal-body show">
                                                                        <p class="details">Note: this will overwrite any existing PDFs for this task.</p>
                                                                        <form id="form-upload-pdf-{{ task.id }}" class="form" action="/pdf_upload" enctype="multipart/form-data" method="post">
                                                                            <input type="hidden" id="task_id" name="task_id" value="{{ task.id }}">
                                                                            <input type="file" name="file">
                                                                            <input type="submit" id="btn-upload-pdf-{{ task.id }}-submit" class="form-field btn btn-primary btn-form-submit" value="upload">
                                                                        </form>
                                                                    </div>
                                                                    <!-- modal footer -->
                                                                    <div class="modal-footer">
                                                                        <button id="btn-btm-close-upload-pdf-{{ task.id }}-modal" type="button" class="btn btn-form-secondary" data-dismiss="modal">Close</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- end UPLOAD PDF modal -->    

                                                        {% if task.pdf_url is not none %}
                                                        <!-- DELETE PDF form -->
                                                        <!-- button to open the modal -->
                                                        <button id="btn-delete-pdf-{{ task.id }}" type="button" class="btn btn-primary inner-accordian-button" data-toggle="modal" data-target="#modal-delete-pdf-{{ task.id }}">
                                                            Delete PDF
                                                        </button>
                                                        <!-- code for modal window -->
                                                        <div class="modal" id="modal-delete-pdf-{{ task.id }}">
                                                            <div class="modal-dialog sup-modal-dialog">
                                                                <div class="modal-content sup-modal">
                                                                    <!-- modal header -->
                                                                    <div class="modal-header">
                                                                    <h4 class="modal-title">Delete PDF</h4>
                                                                        <button  id="btn-top-close-delete-pdf-{{ task.id }}-modal" type="button" class="close" data-dismiss="modal">&times;</button>
                                                                    </div>
                                                                    <!-- modal body -->
                                                                    <div class="modal-body">
                                                                        <h5>Are you sure?</h5>
                                                                        <form class="form" action="" method="post" novalidate>
                                                                            {{ form_delete_pdf.hidden_tag() }}
                                                                            {{ form_delete_pdf.del_pdf_taskID(value=task.id, style="display: none;") }}
                                                                            <a>{{ form_delete_pdf.delete_pdf_submit(class="btn btn-primary btn-form-submit") }}</a>
                                                                        </form>
                                                                    </div>
                                                                    <!-- modal footer -->
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-form-secondary" data-dismiss="modal">Cancel</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- end DELETE PDF modal -->

                                                        <!-- DOWNLOAD PDF form -->
                                                        <div>
                                                            <button id="btn-download-pdf-{{ task.id }}-submit" onclick="downloadPDF('{{ task.pdf_url }}')" class="btn btn-primary inner-accordian-button">
                                                                Download PDF
                                                            </button>
                                                        </div>
                                                        <!-- end DOWNLOAD PDF form -->
                                                        {% endif %}  

                                                        <!-- list of questions for this task outer modal -->
                                                        <div id="accordion_task_{{ task.id }}_questions">
                                                            <div class="card">
                                                                <div class="card-header" id="heading_task_{{ task.id }}_questions">
                                                                    <h5 class="mb-0">
                                                                        <button class="btn btn-link" data-toggle="collapse" data-target="#collapse_task_{{ task.id }}_questions" aria-expanded="true" aria-controls="collapse_task_{{ task.id }}_questions">
                                                                            Questions
                                                                        </button>
                                                                    </h5>
                                                                </div>
                                                                <div id="collapse_task_{{ task.id }}_questions" class="collapse" aria-labelledby="heading_task_{{ task.id }}_questions" data-parent="#accordion_task_{{ task.id }}_questions">
                                                                    <div class="card-body sup-accordian-third-level">

                                                                        <!-- list of questions for this task -->
                                                                        <div id="accordion_questions_task_{{ task.id }}">
                                                                            {% for question in task.questions %}
                                                                                <div class="card">
                                                                                    <div class="card-header" id="heading_question_{{ question.id }}">
                                                                                        <h5 class="mb-0">
                                                                                            <button class="btn btn-link" data-toggle="collapse" data-target="#collapse_question_{{ question.id }}" aria-expanded="true" aria-controls="collapse_question_{{ question.id }}">
                                                                                                {{ question.question_name }}
                                                                                            </button>
                                                                                        </h5>
                                                                                    </div>
                                                                                    <div id="collapse_question_{{ question.id }}" class="collapse" aria-labelledby="heading_question_{{ question.id }}" data-parent="#accordion_questions_task_{{ task.id }}">
                                                                                        <div class="card-body sup-accordian-fourth-level">
                            
                                                                                            <!-- EDIT QUESTION modal -->
                                                                                            <!-- button to open the modal -->
                                                                                            <button id="btn-edit-question-{{ question.id }}" type="button" class="btn btn-primary inner-accordian-button" data-toggle="modal" data-target="#modal-edit-question-{{ question.id }}">
                                                                                                Edit Question
                                                                                            </button>
                                                                                            <!-- code for modal window -->
                                                                                            <div class="modal" id="modal-edit-question-{{ question.id }}">
                                                                                                <div class="modal-dialog sup-modal-dialog">
                                                                                                    <div class="modal-content sup-modal">
                                                                                                        <!-- modal header -->
                                                                                                        <div class="modal-header">
                                                                                                        <h4 class="modal-title">Edit Question</h4>
                                                                                                            <button  id="btn-top-close-edit-question-{{ question.id }}-modal" type="button" class="close" data-dismiss="modal">&times;</button>
                                                                                                        </div>
                                                                                                        <!-- modal body -->
                                                                                                        <div class="modal-body show">
                                                                                                            <form id="form-edit-question-{{ question.id }}" class="form" action="" method="post" novalidate>
                                                                                                                {{ form_edit_question.hidden_tag() }}
                                                                                                                <p>
                                                                                                                    {{ form_edit_question.edit_questionName.label }}<br>
                                                                                                                    {{ form_edit_question.edit_questionName(value=question.question_name, size=32, class="form-field") }}<br>
                                                                                                                    {{ form_edit_question.edit_questionDescription.label }}<br>
                                                                                                                    {{ form_edit_question.edit_questionDescription(value=question.description, size=32, class="form-field") }}<br>
                                                                                                                    {{ form_edit_question.current_questionID(value=question.id, style="display: none;") }}
                                                                                                                </p>
                                                                                                                <a>{{ form_edit_question.edit_question_submit(id="btn-edit-question-{{ question.id }}-submit", size=32, class="form-field btn btn-primary btn-form-submit") }}</a>
                                                                                                            </form>
                                                                                                        </div>
                                                                                                        <!-- modal footer -->
                                                                                                        <div class="modal-footer">
                                                                                                            <button id="btn-btm-close-edit-question-{{ question.id }}-modal" type="button" class="btn btn-form-secondary" data-dismiss="modal">Close</button>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                            <!-- end EDIT QUESTION modal -->
                            
                                                                                            <!-- DELETE QUESTION modal -->
                                                                                            <!-- button to open the modal -->
                                                                                            <button id="btn-delete-question-{{ question.id }}" type="button" class="btn btn-primary inner-accordian-button" data-toggle="modal" data-target="#modal-delete-question-{{ question.id }}">
                                                                                                Delete Question
                                                                                            </button>
                                                                                            <!-- code for modal window -->
                                                                                            <div class="modal" id="modal-delete-question-{{ question.id }}">
                                                                                                <div class="modal-dialog sup-modal-dialog">
                                                                                                    <div class="modal-content sup-modal">
                                                                                                        <!-- modal header -->
                                                                                                        <div class="modal-header">
                                                                                                        <button  id="btn-top-close-delete-question-{{ question.id }}" type="button" class="close" data-dismiss="modal">&times;</button>
                                                                                                        </div>
                                                                                                        <!-- modal body -->
                                                                                                        <div class="modal-body">
                                                                                                            <h5>Are you sure?</h5>
                                                                                                            <p>Deleting a question will permanently delete all student submissions associated with it.</p>
                                                                                                            <form class="form" action="" method="post" novalidate>
                                                                                                                {{ form_delete_question.hidden_tag() }}
                                                                                                                {{ form_delete_question.del_questionID(value=question.id, style="display: none;") }}
                                                                                                                <a>{{ form_delete_question.delete_question_submit(class="btn btn-primary btn-form-submit") }}</a>
                                                                                                            </form>
                                                                                                        </div>
                                                                                                        <!-- modal footer -->
                                                                                                        <div class="modal-footer">
                                                                                                            <button type="button" class="btn btn-form-secondary" data-dismiss="modal">Cancel</button>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                            <!-- end DELETE QUESTION modal -->
                            
                                                                                            <p>Question Description: {{ question.description }}</p>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <hr>
                                                                            {% endfor %}
                                                                        </div>
                                                                        <!-- end list of questions for this task -->

                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <hr>
                                                        </div>
                                                        <!-- end list of questions for this task outer modal -->

                                                        <!-- list of student submissions for this task outer modal -->
                                                        <div id="accordion_task_{{ task.id }}_student_submissions">
                                                            <div class="card">
                                                                <div class="card-header" id="heading_task_{{ task.id }}_student_submissions">
                                                                    <h5 class="mb-0">
                                                                        <button class="btn btn-link" data-toggle="collapse" data-target="#collapse_task_{{ task.id }}_student_submissions" aria-expanded="true" aria-controls="collapse_task_{{ task.id }}_student_submissions">
                                                                            Student Submissions
                                                                        </button>
                                                                    </h5>
                                                                </div>
                                                                <div id="collapse_task_{{ task.id }}_student_submissions" class="collapse" aria-labelledby="heading_task_{{ task.id }}_student_submissions" data-parent="#accordion_task_{{ task.id }}_student_submissions">
                                                                    <div class="card-body sup-accordian-third-level">

                                                                        <!-- download .csv of submitters button -->
                                                                        <button id="btn-download-csv-{{ task.id }}" class="btn btn-primary btn-form-submit publish-feedback-button" onclick="downloadCSV('{{ task.id }}')">
                                                                            Download Submission List
                                                                        </button>
                                                                        <!-- download .csv of submitters button -->

                                                                        <!-- list of students for each task -->
                                                                        <div id="accordion_students">
                                                                            {% for student in task.get_task_users() %}
                                                                                <div class="card">
                                                                                    <div class="card-header" id="heading_student_{{ student.id }}">
                                                                                        <h5 class="mb-0">
                                                                                            <button class="btn btn-link" data-toggle="collapse" data-target="#collapse_student_{{ student.id }}" aria-expanded="true" aria-controls="collapse_student_{{ student.id }}">
                                                                                                {{ student.user_number }}: {{ student.first_name}} {{ student.last_name}}
                                                                                            </button>
                                                                                        </h5>
                                                                                        {% if student.get_task_mark(task.id) is none %}
                                                                                            <p class="details">Task: unmarked</p>
                                                                                        {% else %}
                                                                                            <p class="details">Task Mark: {{ student.get_task_mark(task.id) }}/100</p>
                                                                                        {% endif %}
                                                                                        {% if student.get_task_comment(task.id) is none %}
                                                                                            <p class="details">Comments: no comments</p>
                                                                                        {% else %}
                                                                                            <p class="details">Comments: </p>
                                                                                            <p class="details">{{ student.get_task_comment(task.id) }}</p>
                                                                                        {% endif %}
                                                                                    </div>
                                                                                    <div id="collapse_student_{{ student.id }}" class="collapse" aria-labelledby="heading_student_{{ student.id }}" data-parent="#accordion_students">
                                                                                        <div class="card-body sup-accordian-fourth-level">
                                                                                            
                                                                                            <!-- TASK FEEDBACK section -->
                                                                                            {% include 'teacher_recorder.html' %}
                                                                                            <!-- end TASK FEEDBACK section -->
                                                                                            <p class="details last-detail">Playback:</p>
                                                                                            <div id="playback-{{task.id}}_{{student.id}}"></div>


                                                                                            <!-- list of submitted questions for each student for this task -->
                                                                                            <div id="accordion_submitted_questions">
                                                                                                {% for submitted_question in student.get_task_questions(task.id) %}
                                                                                                    <div class="card">
                                                                                                        <div class="card-header" id="heading_submitted_question_{{ submitted_question.id }}">
                                                                                                            <h5 class="mb-0">
                                                                                                                <button class="btn btn-link" data-toggle="collapse" data-target="#collapse_submitted_question_{{ submitted_question.id }}" aria-expanded="true" aria-controls="collapse_submitted_question_{{ submitted_question.id }}">
                                                                                                                    {{ submitted_question.question_name }}
                                                                                                                </button>
                                                                                                            </h5>
                                                                                                        </div>
                                                                                                        <div id="collapse_submitted_question_{{ submitted_question.id }}" class="collapse" aria-labelledby="heading_submitted_question_{{ submitted_question.id }}" data-parent="#accordion_submitted_questions">
                                                                                                            <div class="card-body sup-accordian-first-level">
                                                                                                                <p>Question Description: {{ submitted_question.description }}</p>
                                                                                                                <!-- TODO: get recording from question.users.recorder_url -->
                                                                                                                <p>Play submission: </p>
                                                                                                                <!-- recording module -->
                                                                                                                {% include "teacher_listen_student.html" %}
                                                                                                                <!-- end recording module -->
                                                                                                            </div>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <hr>
                                                                                                {% endfor %}
                                                                                            </div>
                                                                                            <!-- end list of submitted questions for each student for the task -->
                            
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <hr>
                                                                            {% endfor %}
                                                                        </div>
                                                                        <!-- end list of students for the task -->

                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <hr>
                                                        </div>
                                                        <!-- end list of student submissions for this task outer modal -->

                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    <!-- end list of tasks for the unit -->
                                    
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>   
                <!-- end list of units for the teacher -->
            </div>
        </div>
    </div>
    <!-- end card -->

    <!-- nested forms with validation can't be held open to show errors, need separate modal here -->
    <!-- NOTE: Jinja variable scope does not cross for-loop bounds, workaround found with namespace introduced in Jinja version 2.10 -->

    <!-- EDIT UNIT FORM ERRORS modal -->
    {% set ns = namespace(errors_present=false) %}
    {% for field in form_edit_unit %}
        {% if field.errors|length != 0 %}
            {% set ns.errors_present = true %}
        {% endif %}
    {% endfor %}
    {% if ns.errors_present == true %}
        <script>
            $(document).ready(function(){
                $("#modal-edit-unit-form-errors").modal("show");
            });
        </script>
        <!-- code for modal window -->
        <div class="modal fade" id="modal-edit-unit-form-errors">
            <div class="modal-dialog sup-modal-dialog">
                <div class="modal-content sup-modal">
                    <!-- modal body -->
                    <div class="modal-body show">
                        {% for error in form_edit_unit.edit_unitID.errors %}
                            <span style="color: red;">{{ error }}</span>
                        {% endfor %}
                        <p>Please resubmit form.</p>
                    </div>
                    <!-- modal footer -->
                    <div class="modal-footer">
                        <button id="btn-btm-close-edit-unit-form-errors-modal" type="button" class="btn btn-form-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    <!-- end EDIT UNIT FORM ERRORS modal -->


    <!-- ADD TASK FORM ERRORS modal -->
    {% set ns = namespace(errors_present=false) %}
    {% for field in form_add_task %}
        {% if field.errors|length != 0 %}
            {% set ns.errors_present = true %}
        {% endif %}
    {% endfor %}
    {% if ns.errors_present == true %}
        <script>
            $(document).ready(function(){
                $("#modal-add-task-form-errors").modal("show");
            });
        </script>
        <!-- code for modal window -->
        <div class="modal fade" id="modal-add-task-form-errors">
            <div class="modal-dialog sup-modal-dialog">
                <div class="modal-content sup-modal">
                    <!-- modal body -->
                    <div class="modal-body show">
                        <ul>
                            {% for error in form_add_task.taskName.errors %}
                                <li style="color: red;">Error (Task name): {{ error }}</li>
                            {% endfor %}
                            {% for error in form_add_task.taskDescription.errors %}
                                <li style="color: red;">Error (Description): {{ error }}</li>
                            {% endfor %}
                            {% for error in form_add_task.taskDueDate.errors %}
                                <li style="color: red;">Error: {{ error }}</li>
                            {% endfor %}
                            {% for error in form_add_task.taskDueTime.errors %}
                                <li style="color: red;">Error: {{ error }}</li>
                            {% endfor %}
                        </ul>
                        <p>Please resubmit form.</p>
                    </div>
                    <!-- modal footer -->
                    <div class="modal-footer">
                        <button id="btn-btm-close-add-task-form-errors-modal" type="button" class="btn btn-form-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    <!-- end ADD TASK FORM ERRORS modal -->

    <!-- EDIT TASK FORM ERRORS modal -->
    {% set ns = namespace(errors_present=false) %}
    {% for field in form_edit_task %}
        {% if field.errors|length != 0 %}
            {% set ns.errors_present = true %}
        {% endif %}
    {% endfor %}
    {% if ns.errors_present == true %}
        <script>
            $(document).ready(function(){
                $("#modal-edit-task-form-errors").modal("show");
            });
        </script>
        <!-- code for modal window -->
        <div class="modal fade" id="modal-edit-task-form-errors">
            <div class="modal-dialog sup-modal-dialog">
                <div class="modal-content sup-modal">
                    <!-- modal body -->
                    <div class="modal-body show">
                        <ul>
                            {% for error in form_edit_task.edit_taskName.errors %}
                                <li style="color: red;">Error (Task name): {{ error }}</li>
                            {% endfor %}
                            {% for error in form_edit_task.edit_taskDescription.errors %}
                                <li style="color: red;">Error (Description): {{ error }}</li>
                            {% endfor %}
                            {% for error in form_edit_task.edit_taskDueDate.errors %}
                                <li style="color: red;">Error: {{ error }}</li>
                            {% endfor %}
                            {% for error in form_edit_task.edit_taskDueTime.errors %}
                                <li style="color: red;">Error: {{ error }}</li>
                            {% endfor %}
                        </ul>
                        <p>Please resubmit form.</p>
                    </div>
                    <!-- modal footer -->
                    <div class="modal-footer">
                        <button id="btn-btm-close-edit-task-form-errors-modal" type="button" class="btn btn-form-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    <!-- end EDIT TASK FORM ERRORS modal -->


    <!-- ADD QUESTION FORM ERRORS modal -->
    {% set ns = namespace(errors_present=false) %}
    {% for field in form_add_question %}
        {% if field.errors|length != 0 %}
            {% set ns.errors_present = true %}
        {% endif %}
    {% endfor %}
    {% if ns.errors_present == true %}
        <script>
            $(document).ready(function(){
                $("#modal-add-question-form-errors").modal("show");
            });
        </script>
        <!-- code for modal window -->
        <div class="modal fade" id="modal-add-question-form-errors">
            <div class="modal-dialog sup-modal-dialog">
                <div class="modal-content sup-modal">
                    <!-- modal body -->
                    <div class="modal-body show">
                        <ul>
                            {% for error in form_add_question.questionName.errors %}
                                <li style="color: red;">Error (Question name): {{ error }}</li>
                            {% endfor %}
                            {% for error in form_add_question.questionDescription.errors %}
                                <li style="color: red;">Error (Description): {{ error }}</li>
                            {% endfor %}
                        </ul>
                        <p>Please resubmit form.</p>
                    </div>
                    <!-- modal footer -->
                    <div class="modal-footer">
                        <button id="btn-btm-close-add-question-form-errors-modal" type="button" class="btn btn-form-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    <!-- end ADD QUESTION FORM ERRORS modal -->

    <!-- EDIT QUESTION FORM ERRORS modal -->
    {% set ns = namespace(errors_present=false) %}
    {% for field in form_edit_question %}
        {% if field.errors|length != 0 %}
            {% set ns.errors_present = true %}
        {% endif %}
    {% endfor %}
    {% if ns.errors_present == true %}
        <script>
            $(document).ready(function(){
                $("#modal-edit-question-form-errors").modal("show");
            });
        </script>
        <!-- code for modal window -->
        <div class="modal fade" id="modal-edit-question-form-errors">
            <div class="modal-dialog sup-modal-dialog">
                <div class="modal-content sup-modal">
                    <!-- modal body -->
                    <div class="modal-body show">
                        <ul>
                            {% for error in form_edit_question.edit_questionName.errors %}
                                <li style="color: red;">Error (Question name): {{ error }}</li>
                            {% endfor %}
                            {% for error in form_edit_question.edit_questionDescription.errors %}
                                <li style="color: red;">Error (Description): {{ error }}</li>
                            {% endfor %}
                        </ul>
                        <p>Please resubmit form.</p>
                    </div>
                    <!-- modal footer -->
                    <div class="modal-footer">
                        <button id="btn-btm-close-edit-question-form-errors-modal" type="button" class="btn btn-form-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    <!-- end EDIT QUESTION FORM ERRORS modal -->

    <script>
        // download .csv of submitters function
        function downloadCSV(taskID){
            document.location.href = '{{ DOMAIN_NAME }}' + '/download_csv/sakjhuzhcu213huhd8sacukkd/' + taskID;
        }

        // download pdf function
        function downloadPDF(pdfURL){
            document.location.href = pdfURL;
        }

        var audio
    </script>

{% endblock %}